<!DOCTYPE html>
<html>
<head>
<title>Page Title</title>
</head>
<body>

<h1>Precio kWh hoy:</h1
<div>
  <canvas id="myChart"></canvas>
</div>


<script>
(function() {
    
    fetch("https://api.esios.ree.es/archives/70/download_json?locale=es&date=" + new Date().toJSON().slice(0,10), {
      "headers": {
        "accept": "application/json; application/vnd.esios-api-v2+json",
        "accept-language": "es,gl;q=0.9,en;q=0.8",
        "authorization": "Token token=\"request_your_personal_token_sending_email_to_consultasios@ree.es\"",
        "cache-control": "no-cache",
        "pragma": "no-cache",
        "sec-ch-ua": "\"Google Chrome\";v=\"105\", \"Not)A;Brand\";v=\"8\", \"Chromium\";v=\"105\"",
        "sec-ch-ua-mobile": "?0",
        "sec-ch-ua-platform": "\"macOS\"",
        "sec-fetch-dest": "empty",
        "sec-fetch-mode": "cors",
        "sec-fetch-site": "same-site"
      },
      "referrerPolicy": "no-referrer",
      "body": null,
      "method": "GET",
      "mode": "cors",
      "credentials": "include"
    })
    .then(response => response.json())
    .then(body => { 
       today = body['PVPC'].map(x=> {
           let price = parseFloat(x.EDCGASCYM.replace(",", "."))/1000;
           return {x: x.Hora, y: price}
       }); 

      const data = {
        datasets: [{
          data: today,
          label: "Hoy"
        }]
      };

      const config = {
        type: 'line',
        data: data,
        options: {}
      };
      const myChart = new Chart(
        document.getElementById('myChart'),
        config
      );
    })
})();
   
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>
