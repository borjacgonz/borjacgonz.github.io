<!DOCTYPE html>
<html>
<head>
<title>Page Title</title>
</head>
<body>

  <h1>Precio kWh hoy: <span id="day"></span></h1>
<div>
  <canvas id="myChart"></canvas>
</div>


<script>
(function() {

    todayDate = new Date()
    tomorrowDate = new Date(todayDate)
    tomorrowDate.setDate(todayDate.getDate() + 1)
    yestedayDate = new Date(todayDate)
    yestedayDate.setDate(todayDate.getDate() - 1)
  
  document.getElementById("day").innerHTML = todayDate;
    
    yesterday = getData(yestedayDate.toJSON().slice(0,10));
    today = getData(todayDate.toJSON().slice(0,10));
    tomorrow = getData(tomorrowDate.toJSON().slice(0,10));
    
Promise.all([yesterday, today, tomorrow]).then(function(x) {
    const data = {
        datasets: [{
          data: x[0],
          label: "Ayer"
        },{
          data: x[0],
          label: "Hoy"
        },{
          data: x[0],
          label: "MaÃ±ana"
        }]
      };

      const config = {
        type: 'line',
        data: data,
        options: {}
      };
      const myChart = new Chart(
        document.getElementById('myChart'),
        config
      );
});
})();

function getData(day) {
return fetch("https://api.esios.ree.es/archives/70/download_json?locale=es&date=" + day, {
      "headers": {
        "accept": "application/json; application/vnd.esios-api-v2+json",
        "accept-language": "es,gl;q=0.9,en;q=0.8",
        "authorization": "Token token=\"request_your_personal_token_sending_email_to_consultasios@ree.es\"",
        "cache-control": "no-cache",
        "pragma": "no-cache",
        "sec-ch-ua": "\"Google Chrome\";v=\"105\", \"Not)A;Brand\";v=\"8\", \"Chromium\";v=\"105\"",
        "sec-ch-ua-mobile": "?0",
        "sec-ch-ua-platform": "\"macOS\"",
        "sec-fetch-dest": "empty",
        "sec-fetch-mode": "cors",
        "sec-fetch-site": "same-site"
      },
      "referrerPolicy": "no-referrer",
      "body": null,
      "method": "GET",
      "mode": "cors",
      "credentials": "include"
    })
    .then(response => response.json())
    .then(body => body['PVPC'].map(x=> {
           let price = parseFloat(x.EDCGASCYM.replace(",", "."))/1000;
           return {x: x.Hora, y: price}
       }) 
    );
    }
   
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</body>
</html>
